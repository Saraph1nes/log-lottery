import{d as e,r as a,a as t,o as l,b as n,g as s,h as o,m as r,j as i,u as d,T as p,t as u,k as c,Y as b,am as m,a4 as g,w as f,q as v,v as h,an as w,ao as y,i as x,l as D,R as P,V as k,_}from"./chunk-D-eIezFx.js";import{_ as T}from"./chunk-DN9qMIln.js";import{i as C,u as R,a as O,l as A,b as z}from"./chunk-CXRn-VD0.js";import{_ as L}from"./chunk-CWX2MOUv.js";import{r as N,a as j}from"./chunk-DsM932Ci.js";const W={class:"drawer drawer-end h-0 w-0"},S={class:"drawer-content w-0 h-0 absolute"},F={class:"drawer-side"},U={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},V=e({__name:"index",setup(e,{expose:r}){const i=a(null),d=a(!1);return r({showDrawer:function(){i.value?.click(),d.value=!0},closeDrawer:function(){i.value?.click(),d.value=!1}}),(e,a)=>(l(),t("div",W,[a[1]||(a[1]=n("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),n("div",S,[n("label",{ref_key:"drawerTriggerRef",ref:i,for:"my-drawer-1"},null,512)]),n("div",F,[a[0]||(a[0]=n("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),d.value?(l(),t("div",U,[o(e.$slots,"content")])):s("",!0)])]))}}),$={class:"fieldset"},q={class:"label"},E=["placeholder"],I={class:"fieldset"},J={class:"label",required:""},M=["placeholder"],Y={class:"validator-hint hidden"},B={class:"fieldset"},G={class:"label"},H=["placeholder"],K={class:"btn btn-neutral mt-4",type:"submit"},Q=e({__name:"SinglePerson",props:r({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(e){const{t:a}=i(),s=d(e,"singlePersonData");return(o,r)=>(l(),t("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:r[4]||(r[4]=a=>e.addOnePerson(e.addOnePersonDrawerRef,a))},[n("label",$,[n("span",q,u(c(a)("table.number")),1),p(n("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>s.value.uid=e),type:"text",class:"input validator",placeholder:c(a)("table.number")},null,8,E),[[b,s.value.uid]])]),n("fieldset",I,[n("label",J,[m(u(c(a)("table.name")),1),r[5]||(r[5]=n("span",{class:"text-red-500"},"*",-1))]),p(n("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>s.value.name=e),type:"text",class:"input validator",placeholder:c(a)("table.name"),required:"",minlength:"1"},null,8,M),[[b,s.value.name]]),n("p",Y,u(c(a)("error.personNameEmpty")),1)]),n("label",B,[n("span",G,u(c(a)("table.avatar")),1),p(n("input",{"onUpdate:modelValue":r[2]||(r[2]=e=>s.value.avatar=e),type:"text",class:"input validator",placeholder:c(a)("table.avatar")},null,8,H),[[b,s.value.avatar]])]),n("button",K,u(c(a)("button.confirm")),1),n("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:r[3]||(r[3]=a=>e.addOnePersonDrawerRef.closeDrawer())},u(c(a)("button.cancel")),1)],32))}});function X(e){return new Worker("/log-lottery/assets/importExcel.worker-CWYp5aq3.js",{name:e?.name})}function Z({exportInputFileRef:e}){const{t:t}=i(),l="/log-lottery/".replace("./","/"),n=g.useToast(),s=new X,o=x(A),r=R().personConfig,d=R().prizeConfig,{getAllPersonList:p,getAlreadyPersonList:u}=f(r),c=(b={handleDeletePerson:function(e){r.deletePerson(e)}},[{label:C.global.t("data.number"),props:"uid"},{label:C.global.t("data.name"),props:"name"},{label:C.global.t("data.avatar"),props:"avatar",formatValue:e=>e.avatar?`<img src="${e.avatar}" alt="avatar" style="width: 50px; height: 50px;"/>`:"-"},{label:C.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?C.global.t("data.yes"):C.global.t("data.no")},{label:C.global.t("data.operation"),actions:[{label:C.global.t("data.delete"),type:"btn-error",onClick:e=>{b.handleDeletePerson(e)}}]}]);var b;const m=a(!1),D=a({uid:"",name:"",avatar:""});async function P(){if("zhCn"===C.global.locale.value){return await j(`${l}导入模板示例.xlsx`)}return await j(`${l}personListTemplate-en.xlsx`)}async function k(e){var a;o?.show(),P(),a={type:"start",data:e,templateData:await P()},s&&s.postMessage(a)}return{resetData:function(){r.resetAlreadyPerson(),d.resetPrizeUsage()},deleteAll:function(){r.deleteAllPerson()},handleFileChange:async function(a){s&&(s.onmessage=a=>{if("done"===a.data.type&&(r.resetPerson(),r.addNotPersonList(a.data.data),n.open({message:t("error.importSuccess"),type:"success",position:"top-right"}),e.value&&(e.value.value="")),"error"===a.data.type){if("not right template"===a.data.message)return void n.open({message:t("error.excelFileError"),type:"error",position:"top-right"});n.open({message:a.data.message||t("error.importFail"),type:"error",position:"top-right"})}o?.hide()}),k(await N(a.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(p.value));for(let t=0;t<e.length;t++)delete e[t].x,delete e[t].y,delete e[t].id,delete e[t].createTime,delete e[t].updateTime,delete e[t].prizeId,e[t].isWin?e[t].isWin=C.global.t("data.yes"):e[t].isWin=C.global.t("data.no"),e[t].prizeTime=e[t].prizeTime.join(","),e[t].prizeName=e[t].prizeName.join(",");let a=JSON.stringify(e);if(a=a.replaceAll(/uid/g,C.global.t("data.number")).replaceAll(/isWin/g,C.global.t("data.isWin")).replaceAll(/name/g,C.global.t("data.name")).replaceAll(/prizeName/g,C.global.t("data.prizeName")).replaceAll(/prizeTime/g,C.global.t("data.prizeTime")),e=JSON.parse(a),e.length>0){const a=w.json_to_sheet(e),t=w.book_new();w.book_append_sheet(t,a,"Sheet1"),y(t,"data.xlsx")}},alreadyPersonList:u,allPersonList:p,tableColumnList:c,addOnePerson:function(e,a){a.preventDefault();const t=O([v(D.value)]);t[0].id=h(),r.addOnePerson(t),e.closeDrawer(),D.value={}},addPersonModalVisible:m,singlePersonData:D,downloadTemplate:function(){const e=C.global.t("data.xlsxName");fetch(`${l}${e}`).then(e=>e.blob()).then(a=>{const l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download=e,s.click(),n.open({message:t("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const ee={class:"min-w-1000px"},ae={class:"flex gap-3"},te=["data-tip"],le={class:""},ne={for:"explore"},se=["data-tip"],oe={class:"btn btn-primary btn-sm"},re=e({__name:"index",setup(e){const s=a(),o=a(),r=a(),d=a(),{resetData:p,deleteAll:b,handleFileChange:m,exportData:g,addOnePerson:f,singlePersonData:v,alreadyPersonList:h,allPersonList:w,tableColumnList:y,downloadTemplate:x}=Z({exportInputFileRef:r}),{t:C}=i();return(e,a)=>(l(),t(k,null,[D(z,{ref_key:"resetDataDialogRef",ref:s,title:c(C)("dialog.titleTip"),desc:c(C)("dialog.dialogResetWinner"),"submit-func":c(p)},null,8,["title","desc","submit-func"]),D(z,{ref_key:"delAllDataDialogRef",ref:o,title:c(C)("dialog.titleTip"),desc:c(C)("dialog.dialogDelAllPerson"),"submit-func":c(b)},null,8,["title","desc","submit-func"]),D(V,{ref_key:"addOnePersonDrawerRef",ref:d},{content:P(()=>[D(Q,{"single-person-data":c(v),"onUpdate:singlePersonData":a[0]||(a[0]=e=>_(v)?v.value=e:null),"add-one-person-drawer-ref":d.value,"add-one-person":c(f)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),n("div",ee,[D(L,{title:c(C)("viewTitle.personManagement")},{buttons:P(()=>[n("div",ae,[n("button",{class:"btn btn-error btn-sm",onClick:a[1]||(a[1]=e=>o.value.showDialog())},u(c(C)("button.allDelete")),1),n("div",{class:"tooltip tooltip-bottom","data-tip":c(C)("tooltip.downloadTemplateTip")},[n("button",{class:"no-underline btn btn-secondary btn-sm",onClick:a[2]||(a[2]=(...e)=>c(x)&&c(x)(...e))},u(c(C)("button.downloadTemplate")),1)],8,te),n("div",le,[n("label",ne,[n("div",{class:"tooltip tooltip-bottom","data-tip":c(C)("tooltip.uploadExcelTip")},[n("input",{id:"explore",ref_key:"exportInputFileRef",ref:r,type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:a[3]||(a[3]=(...e)=>c(m)&&c(m)(...e))},null,544),n("span",oe,u(c(C)("button.importData")),1)],8,se)])]),n("button",{class:"btn btn-error btn-sm",onClick:a[4]||(a[4]=e=>s.value.showDialog())},u(c(C)("button.resetData")),1),n("button",{class:"btn btn-accent btn-sm",onClick:a[5]||(a[5]=(...e)=>c(g)&&c(g)(...e))},u(c(C)("button.exportResult")),1),n("button",{class:"btn btn-neutral btn-sm",onClick:a[6]||(a[6]=e=>d.value.showDrawer())},u(c(C)("button.add")),1),n("div",null,[n("span",null,u(c(C)("table.luckyPeopleNumber"))+":",1),n("span",null,u(c(h).length),1),a[7]||(a[7]=n("span",null," / ",-1)),n("span",null,u(c(w).length),1)])])]),_:1},8,["title"]),D(T,{"table-columns":c(y),data:c(w)},null,8,["table-columns","data"])])],64))}});export{re as default};
