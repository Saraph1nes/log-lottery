import{d as e,j as l,r as t,K as a,w as s,c as n,y as o,a as u,o as i,b as r,g as c,t as d,k as p,V as b,W as m,T as f,Y as g,l as v,aq as x,N as h,F as w,a4 as k,s as C,ar as y,f as z,R as U,_ as P,as as L,Z as D,L as W,at as j}from"./chunk-D-eIezFx.js";import{u as V,i as S,d as _}from"./chunk-CXRn-VD0.js";import{_ as I}from"./chunk-CWX2MOUv.js";const A={class:"w-full max-w-3xl overflow-hidden modal-box"},N={class:"pb-4 text-lg font-bold"},R={class:"pb-2 text-sm text-gray-500"},T={key:0,class:"flex flex-wrap gap-2 pb-4"},$={class:"pb-4"},M=["placeholder"],H={class:"overflow-y-auto max-h-64"},q={class:"table w-full table-zebra table-sm"},B={class:"sticky top-0 bg-base-200"},F=["onClick"],K=["checked","disabled","onClick"],Y={key:0,class:"py-8 text-center text-gray-500"},Z={class:"justify-end gap-2 modal-action"},E=e({__name:"index",props:{maxCount:{type:Number,default:1},selectedWinners:{type:Array,default:()=>[]}},emits:["update:selectedWinners","submitData"],setup(e,{expose:k,emit:C}){const y=e,z=C,{t:U}=l(),P=t(),{maxCount:L,selectedWinners:D}=a(y),W=t(""),{personConfig:j}=V(),{getAllPersonList:S}=s(j),_=t([]),I=n(()=>{if(!W.value)return S.value;const e=W.value.toLowerCase();return S.value.filter(l=>l.name.toLowerCase().includes(e)||l.uid.toLowerCase().includes(e))});function E(e){return _.value.some(l=>l.id===e.id)}function G(e){const l=_.value.findIndex(l=>l.id===e.id);if(l>-1)_.value.splice(l,1);else{if(_.value.length>=L.value)return;_.value.push({id:e.id,uid:e.uid,name:e.name})}}function J(){z("update:selectedWinners",[..._.value]),z("submitData",[..._.value]),P.value?.close()}function O(){P.value?.close()}return o(D,e=>{_.value=[...e]},{immediate:!0}),k({openDialog:function(){_.value=[...D.value],W.value="",P.value?.showModal()}}),(e,l)=>(i(),u("dialog",{ref_key:"dialogRef",ref:P,class:"z-50 overflow-hidden border-none modal"},[r("div",A,[r("h3",N,d(p(U)("dialog.selectRiggedWinner")),1),r("p",R,d(p(U)("dialog.riggedWinnerTip",{max:p(L)})),1),_.value.length>0?(i(),u("div",T,[(i(!0),u(b,null,m(_.value,e=>(i(),u("div",{key:e.id,class:"flex items-center gap-1 px-2 py-1 text-sm rounded-full bg-primary/20 text-primary"},[r("span",null,d(e.name)+" ("+d(e.uid)+")",1),v(p(x),{class:"w-4 h-4 cursor-pointer hover:text-error",onClick:l=>function(e){const l=_.value.findIndex(l=>l.id===e.id);l>-1&&_.value.splice(l,1)}(e)},null,8,["onClick"])]))),128))])):c("",!0),r("div",$,[f(r("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>W.value=e),type:"text",placeholder:p(U)("placeHolder.searchPerson"),class:"w-full input input-bordered input-sm"},null,8,M),[[g,W.value]])]),r("div",H,[r("table",q,[r("thead",B,[r("tr",null,[l[1]||(l[1]=r("th",{class:"w-12"},null,-1)),r("th",null,d(p(U)("table.uid")),1),r("th",null,d(p(U)("table.name")),1)])]),r("tbody",null,[(i(!0),u(b,null,m(I.value,e=>(i(),u("tr",{key:e.id,class:h(["cursor-pointer hover",{"bg-primary/10":E(e)}]),onClick:l=>G(e)},[r("td",null,[r("input",{type:"checkbox",class:"checkbox checkbox-sm checkbox-primary",checked:E(e),disabled:!E(e)&&_.value.length>=p(L),onClick:w(l=>G(e),["stop"])},null,8,K)]),r("td",null,d(e.uid),1),r("td",null,d(e.name),1)],10,F))),128))])]),0===I.value.length?(i(),u("div",Y,d(p(U)("error.noData")),1)):c("",!0)]),r("div",Z,[r("button",{class:"btn btn-ghost",onClick:O},d(p(U)("button.cancel")),1),r("button",{class:"btn btn-primary",onClick:J},d(p(U)("button.confirm"))+" ("+d(_.value.length)+"/"+d(p(L))+") ",1)])]),l[2]||(l[2]=r("form",{method:"dialog",class:"modal-backdrop"},[r("button",null,"close")],-1))],512))}});function G(){const e=k.useToast(),l=C.createInstance({name:"imgStore"}),a=V().prizeConfig,n=V().globalConfig,{getPrizeConfig:u,getCurrentPrize:i}=s(a),{getImageList:r}=s(n),c=t([]),d=t(y(u.value)),p=t();return z(()=>{!async function(){(await l.keys()).length>0&&l.iterate((e,l)=>{c.value.push({key:l,value:e})})}()}),o(()=>d.value,e=>{a.setPrizeConfig(e)},{deep:!0}),{addPrize:function(){const l={id:(new Date).getTime().toString(),name:S.global.t("data.prizeName"),sort:0,isAll:!1,count:1,isUsedCount:0,picture:{id:"",name:"",url:""},separateCount:{enable:!1,countList:[]},desc:"",isUsed:!1,isShow:!0,frequency:1,riggedWinners:[]};d.value.push(l),e.success(S.global.t("error.success"))},resetDefault:function(){a.resetDefault(),d.value=y(u.value),e.success(S.global.t("error.success"))},delAll:async function(){d.value=[],e.success(S.global.t("error.success"))},delItem:function(l){const t=d.value.findIndex(e=>e.id===l.id);t>-1&&d.value.splice(t,1),e.success(S.global.t("error.deleteSuccess"))},prizeList:d,currentPrize:i,selectedPrize:p,submitData:function(e){p.value.separateCount.countList=e,p.value=null},changePrizePerson:function(e){let l=-1;for(let t=0;t<d.value.length;t++)if(d.value[t].id===e.id){l=t;break}l>-1&&(d.value[l].separateCount.countList=[],d.value[l].isUsed?d.value[l].isUsedCount=d.value[l].count:d.value[l].isUsedCount=0)},changePrizeStatus:function(e){e.isUsed?e.isUsedCount=0:e.isUsedCount=e.count,e.separateCount.countList=[],e.isUsed=!e.isUsed},selectPrize:function(e){p.value=e,p.value.isUsedCount=0,p.value.isUsed=!1,p.value.separateCount.countList.length>1||(p.value.separateCount={enable:!0,countList:[{id:"0",count:e.count,isUsedCount:0}]})},localImageList:r}}const J={class:"flex w-full gap-3"},O={role:"alert",class:"w-full my-4 alert alert-info"},Q={class:"flex items-center justify-center max-w-xs px-2 handle form-control"},X={class:"w-1/2 max-w-xs form-control"},ee={class:"label"},le={class:"label-text"},te=["onUpdate:modelValue","placeholder"],ae={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},se={class:"label"},ne={class:"label-text"},oe=["checked","onChange"],ue={class:"w-1/2 max-w-xs form-control"},ie={class:"label"},re={class:"label-text"},ce=["onUpdate:modelValue","placeholder","onChange"],de=["data-tip"],pe=["value","max"],be={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},me={class:"label"},fe={class:"label-text"},ge=["checked","onChange"],ve={class:"w-full max-w-xs form-control"},xe={class:"label"},he={class:"label-text"},we=["onUpdate:modelValue"],ke={key:0,value:{id:"",name:"",url:""}},Ce={disabled:"",selected:""},ye=["title","value"],ze={class:"truncate w-option-xs"},Ue={key:0,class:"w-full max-w-xs form-control"},Pe={class:"label"},Le={class:"label-text"},De=["onClick"],We={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},je=["data-tip"],Ve={key:1,class:"btn btn-secondary btn-xs"},Se={class:"w-full max-w-xs form-control"},_e={class:"label"},Ie={class:"label-text"},Ae=["onClick"],Ne={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},Re={key:1,class:"btn btn-warning btn-xs"},Te={class:"w-full max-w-xs form-control"},$e={class:"label"},Me={class:"label-text"},He={class:"flex gap-2"},qe=["onClick"],Be=e({__name:"PrizeConfig",setup(e){const{addPrize:a,resetDefault:s,delAll:n,delItem:o,prizeList:x,currentPrize:w,selectedPrize:k,submitData:C,changePrizePerson:y,changePrizeStatus:z,selectPrize:V,localImageList:S}=G(),{t:A}=l(),N=t(),R=t(null);function T(e){R.value&&(R.value.riggedWinners=e)}return(e,l)=>(i(),u("div",null,[v(I,{title:p(A)("viewTitle.prizeManagement")},{buttons:U(()=>[r("div",J,[r("button",{class:"btn btn-info btn-sm",onClick:l[0]||(l[0]=(...e)=>p(a)&&p(a)(...e))},d(p(A)("button.add")),1),r("button",{class:"btn btn-info btn-sm",onClick:l[1]||(l[1]=(...e)=>p(s)&&p(s)(...e))},d(p(A)("button.resetDefault")),1),r("button",{class:"btn btn-error btn-sm",onClick:l[2]||(l[2]=(...e)=>p(n)&&p(n)(...e))},d(p(A)("button.allDelete")),1)])]),alerts:U(()=>[r("div",O,[l[4]||(l[4]=r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 stroke-current shrink-0"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),r("span",null,d(p(A)("dialog.tipResetPrize")),1)])]),_:1},8,["title"]),v(p(j),{modelValue:p(x),"onUpdate:modelValue":l[3]||(l[3]=e=>P(x)?x.value=e:null),animation:150,handle:".handle",class:"p-0 m-0"},{default:U(()=>[(i(!0),u(b,null,m(p(x),e=>(i(),u("div",{key:e.id,class:h(["flex items-center justify-center gap-10 py-5",p(w).id===e.id?"border border-dotted rounded-xl":null])},[r("label",Q,[v(p(L),{class:"w-10 h-10 cursor-move handle"})]),r("label",X,[r("div",ee,[r("span",le,d(p(A)("table.prizeName")),1)]),f(r("input",{"onUpdate:modelValue":l=>e.name=l,type:"text",placeholder:p(A)("placeHolder.name"),class:"w-full max-w-xs input-sm input input-bordered"},null,8,te),[[g,e.name]])]),r("label",ae,[r("div",se,[r("span",ne,d(p(A)("table.fullParticipation")),1)]),r("input",{type:"checkbox",checked:e.isAll,class:"border-solid checkbox checkbox-secondary border",onChange:l=>e.isAll=!e.isAll},null,40,oe)]),r("label",ue,[r("div",ie,[r("span",re,d(p(A)("table.numberParticipants")),1)]),f(r("input",{"onUpdate:modelValue":l=>e.count=l,type:"number",placeholder:p(A)("placeHolder.winnerCount"),class:"w-full max-w-xs p-0 m-0 input-sm input input-bordered",onChange:l=>p(y)(e)},null,40,ce),[[g,e.count]]),r("div",{class:"tooltip tooltip-bottom","data-tip":`${p(A)("table.isDone")+e.isUsedCount}/${e.count}`},[r("progress",{class:"w-full progress",value:e.isUsedCount,max:e.count},null,8,pe)],8,de)]),r("label",be,[r("div",me,[r("span",fe,d(p(A)("table.isDone")),1)]),r("input",{type:"checkbox",checked:e.isUsed,class:"border-solid checkbox checkbox-secondary border",onChange:l=>p(z)(e)},null,40,ge)]),r("label",ve,[r("div",xe,[r("span",he,d(p(A)("table.image")),1)]),f(r("select",{"onUpdate:modelValue":l=>e.picture=l,class:"truncate select select-warning select-sm"},[e.picture.id?(i(),u("option",ke,"âŒ")):c("",!0),r("option",Ce,d(p(A)("table.selectPicture")),1),(i(!0),u(b,null,m(p(S),e=>(i(),u("option",{key:e.id,title:e.name,class:"w-full max-w-full",value:e},[r("span",ze,d(e.name),1)],8,ye))),128))],8,we),[[D,e.picture]])]),e.separateCount?(i(),u("label",Ue,[r("div",Pe,[r("span",Le,d(p(A)("table.onceNumber")),1)]),r("div",{class:"flex justify-start w-full h-full",onClick:l=>p(V)(e)},[e.separateCount.countList.length?(i(),u("ul",We,[(i(!0),u(b,null,m(e.separateCount.countList,e=>(i(),u("li",{key:e.id,class:"relative flex items-center justify-center w-8 h-8 bg-slate-600/60 separated"},[r("div",{class:"flex items-center justify-center w-full h-full tooltip","data-tip":`${p(A)("tooltip.doneCount")+e.isUsedCount}/${e.count}`},[r("div",{class:"absolute left-0 z-50 h-full bg-blue-300/80",style:W(`width:${100*e.isUsedCount/e.count}%`)},null,4),r("span",null,d(e.count),1)],8,je)]))),128))])):(i(),u("button",Ve,d(p(A)("button.setting")),1))],8,De)])):c("",!0),r("label",Se,[r("div",_e,[r("span",Ie,d(p(A)("table.riggedWinner")),1)]),r("div",{class:"flex justify-start w-full h-full",onClick:l=>function(e){R.value=e,N.value?.openDialog()}(e)},[e.riggedWinners&&e.riggedWinners.length?(i(),u("ul",Ne,[(i(!0),u(b,null,m(e.riggedWinners,e=>(i(),u("li",{key:e.id,class:"px-2 py-1 text-xs rounded-full bg-warning/20 text-warning"},d(e.name),1))),128))])):(i(),u("button",Re,d(p(A)("button.setting")),1))],8,Ae)]),r("label",Te,[r("div",$e,[r("span",Me,d(p(A)("table.operation")),1)]),r("div",He,[r("button",{class:"btn btn-error btn-xs",onClick:l=>p(o)(e)},d(p(A)("button.delete")),9,qe)])])],2))),128))]),_:1},8,["modelValue"]),v(_,{"total-number":p(k)?.count,"separated-number":p(k)?.separateCount.countList,onSubmitData:p(C)},null,8,["total-number","separated-number","onSubmitData"]),v(E,{ref_key:"riggedSelectorRef",ref:N,"max-count":R.value?.count||1,"selected-winners":R.value?.riggedWinners||[],onSubmitData:T},null,8,["max-count","selected-winners"])]))}});export{Be as default};
